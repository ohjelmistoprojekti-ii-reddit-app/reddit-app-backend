{"uid":"f381cd2c46a5e4ac","name":"test_calculate_top_topics_for_existing_subreddit","fullName":"tests.database.test_database_analysis_results.TestCalculateTopTopicsStatistics#test_calculate_top_topics_for_existing_subreddit","historyId":"cd57baa1daf8e0282b21a76c7a419944","time":{"start":1763992052925,"stop":1763992052926,"duration":1},"description":"Test calculating top topics for existing subreddit, and verify that the correct topics statistics are returned. Expects today's statistics to be included.","descriptionHtml":"<p>Test calculating top topics for existing subreddit, and verify that the correct topics statistics are returned. Expects today's statistics to be included.</p>\n","status":"failed","statusMessage":"AssertionError: assert 2 == 3","statusTrace":"self = <test_database_analysis_results.TestCalculateTopTopicsStatistics object at 0x7f361305b830>\nmock_db = Database(mongomock.MongoClient('localhost', 27017), 'reddit')\n\n    @allure.sub_suite(\"Calculate top topics for existing subreddit\")\n    @allure.description(\"Test calculating top topics for existing subreddit, and verify that the correct topics statistics are returned. Expects today's statistics to be included.\")\n    def test_calculate_top_topics_for_existing_subreddit(self, mock_db):\n        db = mock_db\n    \n        subreddit = \"example\"\n        # Ensure test data includes today's date\n        current_date = datetime.now(timezone.utc)\n        test_data =[\n            { \"subreddit\": subreddit, \"topic\": [\"A\", \"B\", \"C\"], \"timestamp\": current_date },\n            { \"subreddit\": subreddit, \"topic\": [\"A\", \"B\", \"Z\"], \"timestamp\": (current_date - timedelta(days=1)) },\n            { \"subreddit\": subreddit, \"topic\": [\"A\", \"Y\", \"X\"], \"timestamp\": (current_date - timedelta(days=2)) },\n        ]\n    \n        # Tested function uses hardcoded collection name \"posts\"\n        db[\"posts\"].insert_many(test_data)\n    \n        # High number_of_days to include all test data\n        number_of_days = 10\n        limit = 3\n        topic_stats = get_top_topics_by_timeperiod(subreddit=subreddit, number_of_days=number_of_days, limit=limit)\n    \n        assert isinstance(topic_stats, list)\n        results = topic_stats[0]\n    \n        assert results[\"topics\"][0][\"topic\"] == \"A\" # Topic A should be the most frequent\n>       assert results[\"topics\"][0][\"count\"] == 3   # Topic A should appear 3 times if today's data is included\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nE       assert 2 == 3\n\ntests/database/test_database_analysis_results.py:213: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"monkeypatch","time":{"start":1763992052925,"stop":1763992052925,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_db","time":{"start":1763992052925,"stop":1763992052925,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"mock_db::0","time":{"start":1763992052931,"stop":1763992052931,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1763992052932,"stop":1763992052932,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"suite","value":"TC-07: Calculate top topics statistics from analysis results"},{"name":"parentSuite","value":"Database tests"},{"name":"subSuite","value":"Calculate top topics for existing subreddit"},{"name":"severity","value":"normal"},{"name":"host","value":"runnervmg1sw1"},{"name":"thread","value":"2570-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.database.test_database_analysis_results"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":6,"broken":0,"skipped":0,"passed":0,"unknown":0,"total":6},"items":[{"uid":"9092874be784d2b8","reportUrl":"https://ohjelmistoprojekti-ii-reddit-app.github.io/reddit-app-backend/13/#testresult/9092874be784d2b8","status":"failed","statusDetails":"AssertionError: assert 2 == 3","time":{"start":1763990239981,"stop":1763990239982,"duration":1}},{"uid":"44c70843f3fe9c25","reportUrl":"https://ohjelmistoprojekti-ii-reddit-app.github.io/reddit-app-backend/12/#testresult/44c70843f3fe9c25","status":"failed","statusDetails":"AssertionError: assert 2 == 3","time":{"start":1763829101606,"stop":1763829101607,"duration":1}},{"uid":"fa13e97c3ac04e5a","reportUrl":"https://ohjelmistoprojekti-ii-reddit-app.github.io/reddit-app-backend/11/#testresult/fa13e97c3ac04e5a","status":"failed","statusDetails":"AssertionError: assert 2 == 3","time":{"start":1763828620944,"stop":1763828620945,"duration":1}},{"uid":"8c63e2dcb42638bf","reportUrl":"https://ohjelmistoprojekti-ii-reddit-app.github.io/reddit-app-backend/10/#testresult/8c63e2dcb42638bf","status":"failed","statusDetails":"AssertionError: assert 2 == 3","time":{"start":1763824513900,"stop":1763824513901,"duration":1}},{"uid":"b4a07083affa510e","reportUrl":"https://ohjelmistoprojekti-ii-reddit-app.github.io/reddit-app-backend/9/#testresult/b4a07083affa510e","status":"failed","statusDetails":"AssertionError: assert 2 == 3","time":{"start":1763821889977,"stop":1763821889978,"duration":1}}]},"tags":[]},"source":"f381cd2c46a5e4ac.json","parameterValues":[]}